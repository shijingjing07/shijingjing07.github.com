<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>supervisor使用详解 | 迪米特</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="迪米特">
  
  
    <meta name="description" content="1.什么是supervisorsupervisor是用python写的一个进程管理工具，用来启动，重启，关闭进程。
2.supervisor的安装
pip install supervisor
3.supervisor的配置文件supervisor安装完毕后，会有一个配置文件supervisord.conf运行
echo_supervisord_conf
命令，可输出文件详细我们使用重定向运算符将">
  
  <meta name="description" content="1.什么是supervisorsupervisor是用python写的一个进程管理工具，用来启动，重启，关闭进程。
2.supervisor的安装
pip install supervisor
3.supervisor的配置文件supervisor安装完毕后，会有一个配置文件supervisord.conf运行
echo_supervisord_conf
命令，可输出文件详细我们使用重定向运算符将">
<meta property="og:type" content="article">
<meta property="og:title" content="supervisor使用详解">
<meta property="og:url" content="https://shijingjing07.github.io/2016/11/02/supervisor使用详解/index.html">
<meta property="og:site_name" content="迪米特">
<meta property="og:description" content="1.什么是supervisorsupervisor是用python写的一个进程管理工具，用来启动，重启，关闭进程。
2.supervisor的安装
pip install supervisor
3.supervisor的配置文件supervisor安装完毕后，会有一个配置文件supervisord.conf运行
echo_supervisord_conf
命令，可输出文件详细我们使用重定向运算符将">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/300946/201611/300946-20161102190531861-1862207493.png">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/300946/201611/300946-20161102190540190-1592905441.png">
<meta property="og:updated_time" content="2017-01-12T01:35:16.382Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="supervisor使用详解">
<meta name="twitter:description" content="1.什么是supervisorsupervisor是用python写的一个进程管理工具，用来启动，重启，关闭进程。
2.supervisor的安装
pip install supervisor
3.supervisor的配置文件supervisor安装完毕后，会有一个配置文件supervisord.conf运行
echo_supervisord_conf
命令，可输出文件详细我们使用重定向运算符将">
<meta name="twitter:image" content="http://images2015.cnblogs.com/blog/300946/201611/300946-20161102190531861-1862207493.png">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">迪米特</a></h1>
    <p><a href="/">路过秋天</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/about">About</a></li>
      
        <li><a href="/atom.xml">rss</a></li>
      
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2016/11/02/supervisor使用详解/">
  <time datetime="2016-11-02T02:57:00.000Z">
    2016-11-02
  </time>
</a>
    
    
  
    <h1 class="title">supervisor使用详解</h1>
  

  </header>
  
  <div class="entry">
    
      <p>1.什么是supervisor<br>supervisor是用python写的一个进程管理工具，用来启动，重启，关闭进程。</p>
<p>2.supervisor的安装</p>
<pre><code>pip install supervisor
</code></pre><p>3.supervisor的配置文件<br>supervisor安装完毕后，会有一个配置文件supervisord.conf<br>运行</p>
<pre><code>echo_supervisord_conf
</code></pre><p>命令，可输出文件详细<br>我们使用重定向运算符将配置文件定向到/etc路径下（方便管理）</p>
<pre><code>echo_supervisord_conf&gt;/etc/supervisord.conf
</code></pre><p>4.配置文件详解</p>
<pre><code>[unix_http_server]
file=/tmp/supervisor.sock ; UNIX socket 文件，supervisorctl 会使用
;chmod=0700 ; socket 文件的 mode，默认是 0700
;chown=nobody:nogroup ; socket 文件的 owner，格式： uid:gid

;[inet_http_server] ; HTTP 服务器，提供 web 管理界面
;port=127.0.0.1:9001 ; Web 管理后台运行的 IP 和端口，如果开放到公网，需要注意安全性
;username=user ; 登录管理后台的用户名
;password=123 ; 登录管理后台的密码

[supervisord]
logfile=/tmp/supervisord.log ; 日志文件，默认是 $CWD/supervisord.log
logfile_maxbytes=50MB ; 日志文件大小，超出会 rotate，默认 50MB
logfile_backups=10 ; 日志文件保留备份数量默认 10
loglevel=info ; 日志级别，默认 info，其它: debug,warn,trace
pidfile=/tmp/supervisord.pid ; pid 文件
nodaemon=false ; 是否在前台启动，默认是 false，即以 daemon 的方式启动
minfds=1024 ; 可以打开的文件描述符的最小值，默认 1024
minprocs=200 ; 可以打开的进程数的最小值，默认 200

; the below section must remain in the config file for RPC
; (supervisorctl/web interface) to work, additional interfaces may be
; added by defining them in separate rpcinterface: sections
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock ; 通过 UNIX socket 连接 supervisord，路径与 unix_http_server 部分的 file 一致
;serverurl=http://127.0.0.1:9001 ; 通过 HTTP 的方式连接 supervisord

; 包含其他的配置文件
[include]
files = relative/directory/*.ini ; 可以是 *.conf 或 *.ini
</code></pre><p>5.进程Program配置</p>
<pre><code>[program:usercenter]
directory = /home/leon/projects/usercenter ; 程序的启动目录
command = gunicorn -c gunicorn.py wsgi:app ; 启动命令，可以看出与手动在命令行启动的命令是一样的
autostart = true ; 在 supervisord 启动的时候也自动启动
startsecs = 5 ; 启动 5 秒后没有异常退出，就当作已经正常启动了
autorestart = true ; 程序异常退出后自动重启
startretries = 3 ; 启动失败自动重试次数，默认是 3
user = leon ; 用哪个用户启动
redirect_stderr = true ; 把 stderr 重定向到 stdout，默认 false
stdout_logfile_maxbytes = 20MB ; stdout 日志文件大小，默认 50MB
stdout_logfile_backups = 20 ; stdout 日志文件备份数
; stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）
stdout_logfile = /data/logs/usercenter_stdout.log

; 可以通过 environment 来添加需要的环境变量，一种常见的用法是修改 PYTHONPATH
; environment=PYTHONPATH=$PYTHONPATH:/path/to/somewhere
</code></pre><p>将进程配置添加到supervisord.conf文件中<br>推荐将各个进程配置放到单独的文件中，然后通过[include]配置项引用</p>
<pre><code>[include]
files = /etc/supervisor/*.conf
</code></pre><p>6.supervisor服务启动<br>运行命令</p>
<pre><code>supervisord -c /etc/supervisord.conf
</code></pre><p>启动服务<br>若服务已启动会报以下错误：<br><img src="http://images2015.cnblogs.com/blog/300946/201611/300946-20161102190531861-1862207493.png" alt=""><br>查找服务进程，kill，重新运行<br><img src="http://images2015.cnblogs.com/blog/300946/201611/300946-20161102190540190-1592905441.png" alt=""></p>
<p>7.supervisor服务客户端管理<br>可以使用supervisord的命令行客户端管理工具supervisorctl，来管理进程。</p>
<pre><code>$ supervisorctl status
$ supervisorctl stop usercenter
$ supervisorctl start usercenter
$ supervisorctl restart usercenter
$ supervisorctl reread
$ supervisorctl update
</code></pre><p>8.supervisor web管理界面</p>
<pre><code>;[inet_http_server] ; HTTP 服务器，提供 web 管理界面
;port=127.0.0.1:9001 ; Web 管理后台运行的 IP 和端口，如果开放到公网，需要注意安全性
;username=user ; 登录管理后台的用户名
;password=123 ; 登录管理后台的密码
</code></pre><p>在浏览器中输入<a href="http://127.0.0.1:9001，可进入web管理界面" target="_blank" rel="external">http://127.0.0.1:9001，可进入web管理界面</a></p>

    
  </div>
  <footer>
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


<section id="comment">
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/11/02/supervisor使用详解/" data-title="supervisor使用详解" data-url="https://shijingjing07.github.io/2016/11/02/supervisor使用详解/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"shijingjing07"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</section>
</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2017 <a href="/">迪米特</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: 'shijingjing07' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>